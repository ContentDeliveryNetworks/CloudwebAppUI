<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Messenger Clone Async Multi-Flow Bot</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
* {margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Helvetica, Arial, sans-serif;}
body {background:#000; height:100vh; display:flex; justify-content:center; align-items:center; overflow:hidden; color:#fff;}
.loading-screen {position:absolute; top:0; left:0; width:100%; height:100%; background:#111; display:flex; justify-content:center; align-items:center; z-index:1000; flex-direction:column; transition:opacity 0.5s ease;}
.loading-screen.hidden {opacity:0; pointer-events:none;}
.loader {width:50px; height:50px; border:5px solid #333; border-top:5px solid #00a2ff; border-radius:50%; animation:spin 1s linear infinite; margin-bottom:10px;}
@keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
.chat-container {width:360px; height:700px; background:#111; border-radius:12px; box-shadow:0 10px 25px rgba(0,0,0,0.5); display:flex; flex-direction:column; overflow:hidden; display:none;}
.chat-header {display:flex; align-items:center; padding:10px 15px; background:#1a1a1a; color:white; box-shadow:0 1px 2px rgba(0,0,0,0.5); position:relative; z-index:10;}
.back-button {margin-right:10px; font-size:20px; cursor:pointer;}
.avatar {width:40px; height:40px; border-radius:50%; overflow:hidden; margin-right:10px; border:2px solid #00a2ff;}
.avatar img {width:100%; height:100%; object-fit:cover;}
.user-info {flex:1;}
.user-name {font-weight:600; font-size:16px;}
.user-status {font-size:12px; opacity:0.7;}
.header-icons {display:flex; gap:15px;}
.header-icons i {font-size:18px; cursor:pointer;}
.chat-messages {flex:1; padding:15px; overflow-y:auto; background:#000;}
.date-separator {text-align:center; margin:15px 0; font-size:12px; color:#888; position:relative;}
.date-separator:before {content:""; position:absolute; left:0; top:50%; right:0; height:1px; background:#333; z-index:1;}
.date-separator span {background:#000; padding:0 10px; position:relative; z-index:2;}
.message {display:flex; margin-bottom:10px; position:relative;}
.message.received {justify-content:flex-start;}
.message.sent {justify-content:flex-end;}
.message-content {max-width:70%; padding:8px 12px; border-radius:18px; position:relative; margin:0 5px; word-break:break-word;}
.received .message-content {background:#1a1a1a; border-top-left-radius:4px;}
.sent .message-content {background:dodgerblue; color:white; border-top-right-radius:4px;}
.message-time {font-size:10px; color:#888; text-align:right; margin-top:2px;}
.sent .message-time {color:rgba(255,255,255,0.8);}
.typing-indicator {display:flex; align-items:center; padding:8px 12px; background:#1a1a1a; border-radius:18px; border-top-left-radius:4px; width:fit-content; margin-bottom:10px; opacity:0; transition:opacity 0.3s;}
.typing-indicator.visible {opacity:1;}
.typing-dot {width:6px; height:6px; background:white; border-radius:50%; margin:0 2px; animation:typingAnimation 1.4s infinite ease-in-out;}
.typing-dot:nth-child(1){animation-delay:0s;}
.typing-dot:nth-child(2){animation-delay:0.2s;}
.typing-dot:nth-child(3){animation-delay:0.4s;}
@keyframes typingAnimation{0%,60%,100%{transform:translateY(0);}30%{transform:translateY(-5px);} }
.chat-input {display:flex; align-items:center; padding:10px 15px; background:#111; border-top:1px solid #333;}
.input-container {flex:1; background:#1a1a1a; border-radius:20px; display:flex; align-items:center; padding:5px 15px; margin-right:10px;}
.input-container i {color:#888; margin:0 5px; cursor:pointer;}
.chat-input input {flex:1; border:none; outline:none; padding:8px 5px; font-size:14px; color:#fff; background:transparent;}
.send-button {width:36px; height:36px; border-radius:50%; background:dodgerblue; color:white; display:flex; justify-content:center; align-items:center; cursor:pointer;}
@media (max-width:400px){.chat-container{width:100%; height:100%; border-radius:0;} body{background:#000;}}

</style>
</head>
<body>

<div class="loading-screen" id="loadingScreen">
    <div class="loader"></div>
    <p style="color:#fff;">Chats are loadingâ€¦</p>
</div>

<div class="chat-container" id="chatContainer">
    <div class="chat-header">
        <div class="back-button"><i class="fas fa-chevron-left"></i></div>
        <div class="avatar"><img src="./UserClient/8D.jpg"/></div>
        <div class="user-info">
            <div class="user-name">Divya Joshi</div>
            <div class="user-status">Online Now</div>
        </div>
        <div class="header-icons">
            <i class="fas fa-video"></i>
            <i class="fas fa-phone"></i>
        </div>
    </div>

    <div class="chat-messages" id="chatMessages"></div>

    <div class="chat-input">
        <div class="input-container">
            <i class="fas fa-smile"></i>
            <input type="text" id="chatInput" placeholder="Type a message..." />
        </div>
        <div class="send-button" id="sendBtn"><i class="fas fa-paper-plane"></i></div>
    </div>
</div>

<script>
// References
const loadingScreen = document.getElementById('loadingScreen');
const chatContainer = document.getElementById('chatContainer');
const chatMessages = document.getElementById('chatMessages');
const chatInput = document.getElementById('chatInput');
const sendBtn = document.getElementById('sendBtn');

let botData = [];

// Load bot data from JSON
async function loadBotData() {
    try {
        const res = await fetch('https://syncjson.pages.dev/InAppChat.json'); // replace with your JSON
        botData = await res.json();
    } catch(e) {
        console.error('Failed to load bot data:', e);
    }
}

// Format IST time
function formatTime(ts){
    const d=new Date(ts);
    return d.toLocaleTimeString('en-IN',{hour:'numeric',minute:'2-digit',hour12:true,timeZone:'Asia/Kolkata'});
}

// Date separator
let lastDate='';
function addDateSeparator(){
    const d=new Date();
    const today=new Date();
    const yesterday=new Date(); yesterday.setDate(today.getDate()-1);
    let label='';
    if(d.toDateString()===today.toDateString()) label='Today';
    else if(d.toDateString()===yesterday.toDateString()) label='Yesterday';
    else label=d.toDateString();
    if(lastDate!==label){
        const div=document.createElement('div');
        div.className='date-separator';
        div.innerHTML=`<span>${label}</span>`;
        chatMessages.appendChild(div);
        lastDate=label;
    }
}

// Append message
function appendMessage(text,sender){
    addDateSeparator();
    const div=document.createElement('div');
    div.className='message '+(sender==='me'?'sent':'received');
    const avatar=sender==='me'?'./krisna.jpg':'./UserClient/8D.jpg';
    div.innerHTML=`<div class="avatar"><img src="${avatar}"/></div><div class="message-content">${text}<div class="message-time">${formatTime(Date.now())}</div></div>`;
    chatMessages.appendChild(div);
    chatMessages.scrollTop=chatMessages.scrollHeight;
}

// Typing indicator
function showTyping(){
    const div=document.createElement('div');
    div.className='typing-indicator visible';
    div.innerHTML=`<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>`;
    chatMessages.appendChild(div);
    chatMessages.scrollTop=chatMessages.scrollHeight;
    return div;
}

// Bot reply based on JSON flows
function botReply(msg){
    const typingEl = showTyping();
    setTimeout(()=>{
        typingEl.remove();
        let reply="I will reply later ðŸ˜ˆ"; // default fallback
        const userMsg = msg.toLowerCase();

        for(let flow of botData){
            for(let trigger of flow.triggers){
                if(userMsg.includes(trigger.toLowerCase())){
                    reply = flow.responses[Math.floor(Math.random()*flow.responses.length)];
                    break;
                }
            }
        }
        appendMessage(reply,'bot');
    }, 3000 + Math.random()*3000); // random typing delay 3-6s
}

// Send message
function sendMessage(){
    const text=chatInput.value.trim();
    if(!text) return;
    appendMessage(text,'me');
    chatInput.value='';
    setTimeout(()=>botReply(text),1000); // bot start after 1s
}

// Event listeners
sendBtn.addEventListener('click',sendMessage);
chatInput.addEventListener('keypress',e=>{if(e.key==='Enter') sendMessage();});

// Show chat when ready
window.addEventListener('load', async ()=>{
    await loadBotData(); // Load JSON first
    setTimeout(()=>{
        loadingScreen.classList.add('hidden');
        chatContainer.style.display='flex';
        chatInput.focus();
    },100);
});
</script>

</body>
</html>
