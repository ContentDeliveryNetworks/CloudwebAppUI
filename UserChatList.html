<!DOCTYPE HTML>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover" />
<title>Demo Message</title>
<link rel="stylesheet" href="styles/bootstrap.css">
<link rel="stylesheet" href="styles/style.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="fonts/css/fontawesome-all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
<style>
/* Chat container */
.content {
    overflow-y: auto;
    max-height: calc(100vh - 98px);
    padding: 10px 10px 120px 10px;
}

/* Speech bubbles */
.speech-bubble {
    padding: 8px 12px;
    margin-bottom: 8px;
    border-radius: 16px;
    display: inline-block;
    max-width: 75%;
}
.speech-left { background-color: #0d6efd; color: white; float: left; }
.speech-right { background-color: #e5e5ea; color: black; float: right; }
.clearfix { clear: both; }

/* Typing dots animation */
.typing-dot { display: inline-block; font-weight: bold; animation: blink 1s infinite; }
.typing-dot:nth-child(1) { animation-delay: 0s; }
.typing-dot:nth-child(2) { animation-delay: 0.2s; }
.typing-dot:nth-child(3) { animation-delay: 0.4s; }
@keyframes blink { 0%,80%,100% { opacity: 0; } 40% { opacity: 1; } }

/* Footer input */
#footer-bar { display: flex; padding: 8px; background: #f2f2f2; position: fixed; bottom: 0; width: 100%; box-sizing: border-box; }
.speach-input { flex: 1; margin: 0 8px; }
.speach-input input { width: 100%; padding: 10px; border-radius: 25px; border: 1px solid #ccc; }
</style>
</head>
<body class="theme-light">

<div class="content"></div>

<div id="footer-bar">
    <div class="speach-icon">
        <button type="button" id="sendBtn" class="gradient-highlight color-white me-2">
            <i class="fa fa-arrow-up pt-2"></i>
        </button>
    </div>
    <div class="speach-input">
        <input type="text" id="chatInput" placeholder="Enter your Message here" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" inputmode="text">
    </div>
</div>

<script>
// Chat elements
const chatContent = document.querySelector('.content');
const inputField = document.getElementById('chatInput');
const sendBtn = document.getElementById('sendBtn');

// Sounds
const sendSound = new Audio('./UserClient/Sending.mp3');
const notifySound = new Audio('./UserClient/Notification.mp3');
const typingSound = new Audio('./UserClient/Typing.mp3');

// Unique user ID
let userID = localStorage.getItem('chatUserID');
if (!userID) { userID = 'user_' + Date.now() + '_' + Math.floor(Math.random()*10000); localStorage.setItem('chatUserID', userID); }
const storageKey = 'chatHistory_' + userID;

// Restore chat
window.addEventListener('load', () => {
    const savedChat = localStorage.getItem(storageKey);
    if(savedChat) chatContent.innerHTML = savedChat;
    scrollToBottom();
    inputField.focus();
});

// Scroll to bottom
function scrollToBottom() {
    chatContent.scrollTo({ top: chatContent.scrollHeight, behavior: 'smooth' });
}

// Add message
function addMessage(message, sender='user') {
    const div = document.createElement('div');
    div.classList.add('speech-bubble');
    if(sender==='user') div.classList.add('speech-left'); else div.classList.add('speech-right');
    div.textContent = message;
    chatContent.appendChild(div);
    const clearDiv = document.createElement('div');
    clearDiv.classList.add('clearfix');
    chatContent.appendChild(clearDiv);
    saveChat();
    scrollToBottom();
    if(sender==='user') sendSound.play(); else notifySound.play();
}

// Save chat
function saveChat() { localStorage.setItem(storageKey, chatContent.innerHTML); }

// Get IST time
function getIndiaTime() {
    const now = new Date();
    const istTime = new Date(now.getTime() + (330 + now.getTimezoneOffset())*60000);
    let hours = istTime.getHours(), minutes = istTime.getMinutes(), ampm = hours>=12?'PM':'AM';
    hours = hours%12||12; minutes = minutes<10?'0'+minutes:minutes;
    return hours+':'+minutes+' '+ampm;
}

// Bot queue
const botQueue = []; let botBusy = false; let typingDiv = null; let typingInterval = null;

function animateTypingDots() {
    if(!typingDiv) return;
    let dots=0;
    typingInterval = setInterval(()=>{
        dots=(dots+1)%4;
        typingDiv.firstChild.textContent='Divya Joshi is Typing'+'.'.repeat(dots);
    },500);
}

function stopTypingAnimation() { if(typingInterval) clearInterval(typingInterval); typingInterval=null; if(typingDiv){ typingDiv.remove(); typingDiv=null; } }

function processBotQueue() {
    if(botBusy||botQueue.length===0) return; botBusy=true;
    const message = botQueue.shift();
    setTimeout(()=>{
        if(!typingDiv){
            typingDiv=document.createElement('div');
            typingDiv.classList.add('speech-bubble','speech-right');
            typingDiv.appendChild(document.createTextNode('Divya Joshi is Typing'));
            chatContent.appendChild(typingDiv);
            const clearDiv=document.createElement('div'); clearDiv.classList.add('clearfix'); chatContent.appendChild(clearDiv);
            animateTypingDots();
        }
        const scrollInterval=setInterval(scrollToBottom,100);
        typingSound.loop=true; typingSound.play();
        setTimeout(()=>{
            clearInterval(scrollInterval); stopTypingAnimation(); typingSound.pause(); typingSound.currentTime=0;
            let reply="Sorry, I didn't understand that.";
            const msg=message.toLowerCase();
            const keywords=[
                { keys:['hi','hello','hey'], reply:'Hello! How are you today?' },
                { keys:['time','current time'], reply:'Current IST time is '+getIndiaTime() },
                { keys:['bye','goodbye'], reply:'Goodbye! Have a nice day!' },
                { keys:['how are you'], reply:'I am just a bot, but doing great!' },
                { keys:['your name','who are you'], reply:'I am Divya Joshi' },
                { keys:['demo','sample'], reply:'This is a demo bot showing example keywords.' }
            ];
            for(let k of keywords){ for(let w of k.keys){ if(msg.includes(w)){ reply=k.reply; break; } } }
            addMessage(reply,'bot'); botBusy=false; processBotQueue();
        },3000);
    },1000);
}

function botResponse(message){ botQueue.push(message); processBotQueue(); }

// Send message
function sendMessage() {
    const message = inputField.value.trim(); if(!message) return;
    addMessage(message,'user'); inputField.value='';
    botResponse(message);
}

// Event listeners
sendBtn.addEventListener('click', sendMessage);
inputField.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.keyCode===13){ e.preventDefault(); sendMessage(); } });
</script>

</body>
</html>
